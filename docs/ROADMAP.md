# 开发路线图

## 概述

本文档定义 MEME Perp DEX 的开发里程碑和任务分解。

---

## 当前状态

### 已完成

- [x] 项目基础架构搭建
- [x] 前端框架 (Next.js + TailwindCSS)
- [x] 后端框架 (Go + Gin)
- [x] 智能合约框架 (Foundry)
- [x] 基础文档 (PRD, 架构设计)

### 待清理

- [x] 删除域名相关功能代码
- [x] 清理前端组件中的域名引用
- [x] 更新 WebSocket 接口规范

---

## Phase 1: 核心基础设施

### 1.1 智能合约核心

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| MemeToken.sol | P0 | ✅ | ERC20 MEME 代币 |
| Vault.sol | P0 | ✅ | BNB 保证金托管 |
| AMM.sol | P0 | ✅ | 恒定乘积现货交易 |
| PriceFeed.sol | P0 | ✅ | 价格聚合 + TWAP |
| PositionManager.sol | P0 | ✅ | 仓位核心逻辑 |

**验收标准:**
- 合约编译通过
- 基础单元测试覆盖 > 80%
- 本地 Anvil 部署测试通过

### 1.2 后端核心服务

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 数据库初始化 | P0 | ✅ | PostgreSQL schema + Auto Migration |
| 配置管理 | P0 | ✅ | Viper 配置 + 环境变量 |
| 账户服务 | P0 | ✅ | 余额、仓位、杠杆查询 |
| 市场数据服务 | P0 | ✅ | 行情、K线、成交、深度 |
| WebSocket 服务 | P0 | ✅ | Hub 架构 + 实时推送 |

**验收标准:**
- API 服务可启动
- 基础 API 可访问
- WebSocket 连接可建立

### 1.3 前端基础页面

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 首页 Token 列表 | P0 | ✅ | 预售列表 + 可交易代币列表 (连接后端API) |
| 交易页面框架 | P0 | ✅ | K线图表 + 实时数据 + 下单面板 |
| 钱包连接 | P0 | ✅ | RainbowKit + Wagmi 已集成 |
| 基础状态管理 | P0 | ✅ | Zustand 双 Store (appStore + tradeStore) |

**验收标准:**
- 前端可以正常启动
- 钱包可以连接
- 页面路由正常

---

## Phase 2: 交易功能

### 2.1 现货交易

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| AMM 现货买入 | P0 | ✅ | BNB -> MEME (SpotSwapPanel + useSpotSwap) |
| AMM 现货卖出 | P0 | ✅ | MEME -> BNB (SpotSwapPanel + useSpotSwap) |
| 滑点保护 | P0 | ✅ | 最小获得量校验 |
| 交易历史 | P1 | ⬜ | 记录用户交易 |
| 实时价格推送 | P0 | ✅ | WebSocket 推送 (useTradeStream) |

**验收标准:**
- ✅ 可以完成现货买卖
- ✅ 价格实时更新
- ⬜ 交易历史可查

### 2.2 永续合约开平仓

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 开多仓 | P0 | ✅ | 市价开多 (usePerpetual + PerpTradingPanel) |
| 开空仓 | P0 | ✅ | 市价开空 + 借币 (usePerpetual + PerpTradingPanel) |
| 平仓 | P0 | ✅ | 市价平仓 (usePerpetual) |
| 部分平仓 | P1 | ✅ | 部分平仓支持 (closePositionPartial) |
| 仓位展示 | P0 | ✅ | 实时盈亏显示 (perp/page.tsx 持仓表格) |
| 杠杆调整 | P1 | ⬜ | 调整杠杆倍数 |

**验收标准:**
- ✅ 可以开多/空仓位
- ✅ 仓位盈亏实时更新
- ✅ 可以平仓并结算

### 2.3 K 线图表

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| K 线数据聚合 | P0 | ✅ | 后端 K 线生成 (candle.go CandleService) |
| K 线历史接口 | P0 | ✅ | REST API (/api/market/candles) |
| K 线实时更新 | P0 | ✅ | WebSocket 推送 (candle.go ProcessTrade + Hub.Broadcast) + 前端 KlineAggregator |
| 图表组件 | P0 | ✅ | TradingView Lightweight Charts (TokenPriceChart) |
| 多时间周期 | P1 | ✅ | 1m/5m/15m/1H/4H/1D 支持 |

**验收标准:**
- ✅ K 线图表正常显示
- ✅ 实时更新 (通过 useDomainTradeStream + KlineAggregator)
- ✅ 支持多周期切换

---

## Phase 3: 风控与清算

### 3.1 清算系统

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| Liquidation.sol | P0 | ⬜ | 清算合约 |
| 清算价格计算 | P0 | ⬜ | TWAP 价格 |
| 清算 Keeper | P0 | ⬜ | 监控可清算仓位 |
| 清算奖励分配 | P0 | ⬜ | 清算人奖励 |
| 清算事件推送 | P1 | ⬜ | 通知用户 |

**验收标准:**
- 低保证金率仓位可被清算
- 清算人获得奖励
- 清算事件被记录

### 3.2 资金费率

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| FundingRate.sol | P0 | ⬜ | 资金费率合约 |
| 费率计算 | P0 | ⬜ | 基于多空比例 |
| 定时结算 | P0 | ⬜ | 每 4 小时 |
| 资金费 Keeper | P0 | ⬜ | 触发结算 |
| 费率展示 | P1 | ⬜ | 前端显示 |

**验收标准:**
- 资金费每 4 小时结算
- 多空方向正确收付
- 历史费率可查

### 3.3 风控参数

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| RiskManager.sol | P1 | ⬜ | 风控参数管理 |
| 仓位限制 | P1 | ⬜ | 最大仓位比例 |
| 价格保护 | P1 | ⬜ | 异常价格拦截 |
| 开仓冷却 | P2 | ⬜ | 防闪电贷 |

**验收标准:**
- 超限仓位无法开立
- 异常价格被拦截

---

## Phase 4: 高级功能

### 4.1 订单簿

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| OrderBook.sol | P1 | ⬜ | 限价单合约 |
| 限价开仓单 | P1 | ⬜ | 限价开多/空 |
| 订单 Keeper | P1 | ⬜ | 订单成交匹配 |
| 订单管理 UI | P1 | ⬜ | 挂单/撤单 |

### 4.2 止盈止损

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| TakeProfitStopLoss.sol | P1 | ⬜ | TP/SL 合约 |
| TP/SL 设置 | P1 | ⬜ | 创建 TP/SL 单 |
| TP/SL Keeper | P1 | ⬜ | 价格触发执行 |
| 追踪止损 | P2 | ⬜ | Trailing Stop |

### 4.3 LP 借贷

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| LendingPool.sol | P1 | ⬜ | LP 借贷合约 |
| LP 存款 | P1 | ⬜ | 存入 MEME |
| LP 取款 | P1 | ⬜ | 取出 MEME + 利息 |
| 利率模型 | P1 | ⬜ | 动态利率 |
| LP 页面 | P1 | ⬜ | 存取款 UI |

---

## Phase 5: 内盘认购

### 5.1 内盘功能

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| Presale.sol | P0 | ⬜ | 内盘合约 |
| 创建内盘 | P0 | ⬜ | 发起认购 |
| 认购 | P0 | ⬜ | 参与认购 |
| 退款 | P0 | ⬜ | 未打满退款 |
| 激活交易 | P0 | ⬜ | 打满后初始化 |
| 内盘页面 | P0 | ⬜ | 认购 UI |

**验收标准:**
- 可以创建新内盘
- 可以认购和退款
- 打满后自动激活交易

---

## Phase 6: 用户体验

### 6.1 推荐返佣

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| Referral.sol | P1 | ⬜ | 返佣合约 |
| 推荐码生成 | P1 | ⬜ | 生成专属码 |
| 返佣记录 | P1 | ⬜ | 返佣明细 |
| 邀请页面 | P1 | ⬜ | 邀请 UI |

### 6.2 账户功能

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 账户概览 | P1 | ⬜ | 资产总览 |
| 交易历史 | P1 | ⬜ | 历史记录 |
| 盈亏统计 | P2 | ⬜ | PnL 分析 |
| 设置页面 | P2 | ⬜ | 偏好设置 |

### 6.3 国际化

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 中文支持 | P0 | ✅ | zh-CN |
| 英文支持 | P0 | ✅ | en-US |
| 日文支持 | P2 | ✅ | ja-JP |
| 韩文支持 | P2 | ✅ | ko-KR |

---

## Phase 7: 测试与部署

### 7.1 测试

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 合约单元测试 | P0 | ⬜ | Foundry Test |
| 合约集成测试 | P0 | ⬜ | Fork Test |
| 合约模糊测试 | P1 | ⬜ | Fuzz Test |
| 后端 API 测试 | P1 | ⬜ | API 测试 |
| 前端 E2E 测试 | P2 | ⬜ | Playwright |

### 7.2 部署

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 测试网部署 | P0 | ⬜ | BSC Testnet |
| 后端部署 | P0 | ⬜ | Railway/AWS |
| 前端部署 | P0 | ⬜ | Vercel |
| 域名配置 | P1 | ⬜ | DNS + SSL |
| 监控告警 | P1 | ⬜ | Prometheus |

### 7.3 安全审计

| 任务 | 优先级 | 状态 | 说明 |
|------|--------|------|------|
| 内部审计 | P0 | ⬜ | 代码审查 |
| 第三方审计 | P0 | ⬜ | 外部审计 |
| Bug 修复 | P0 | ⬜ | 修复问题 |
| 主网部署 | P0 | ⬜ | BSC Mainnet |

---

## 里程碑总结

| 阶段 | 目标 | 关键成果 |
|------|------|----------|
| Phase 1 | 基础设施 | 核心合约 + 基础服务 + 页面框架 |
| Phase 2 | 交易功能 | 现货交易 + 永续开平仓 + K 线 |
| Phase 3 | 风控系统 | 清算 + 资金费率 |
| Phase 4 | 高级功能 | 限价单 + 止盈止损 + LP |
| Phase 5 | 内盘认购 | 完整内盘流程 |
| Phase 6 | 用户体验 | 推荐返佣 + 账户功能 |
| Phase 7 | 测试部署 | 审计 + 上线 |

---

## 开发规范

### 代码提交

```
feat: 新功能
fix: Bug 修复
docs: 文档更新
refactor: 代码重构
test: 测试相关
chore: 构建/工具
```

### 分支策略

- `main` - 生产分支
- `develop` - 开发分支
- `feature/*` - 功能分支
- `fix/*` - 修复分支

### 代码审查

- 所有 PR 需要至少 1 人审查
- 合约代码需要 2 人审查
- CI 测试必须通过
