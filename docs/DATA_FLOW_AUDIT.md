# æ•°æ®æµå®¡è®¡æŠ¥å‘Š

> åƒè­¦å¯ŸæŸ¥æ¡ˆä¸€æ ·ï¼Œè¿½è¸ªæ¯æ¡æ•°æ®çº¿

---

## ä¸€ã€æœåŠ¡çŠ¶æ€æ£€æŸ¥

| æœåŠ¡ | ç«¯å£ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| Frontend (Next.js) | 3000 | âœ… è¿è¡Œ | |
| Go Backend | 8080 | âœ… è¿è¡Œ | |
| Matching Engine | 8081 | âœ… è¿è¡Œ | |
| PostgreSQL | 5432 | âœ… è¿è¡Œ | |
| Redis | 6379 | âœ… è¿è¡Œ | |

---

## äºŒã€æ•°æ®çº¿è¿½è¸ª

### æ•°æ®çº¿ #1: å½“å‰ä»·æ ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ˜¾ç¤º                                                          â”‚
â”‚ æ–‡ä»¶: PerpetualTradingTerminal.tsx:474                              â”‚
â”‚ ä»£ç : {marketInfo.currentPrice}                                     â”‚
â”‚ æ˜¾ç¤º: $0.0000062234                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Hook è°ƒç”¨                                                         â”‚
â”‚ æ–‡ä»¶: hooks/useTokenStats.ts:60                                     â”‚
â”‚ ä»£ç : const formattedPrice = formatMemePrice(stats?.price)          â”‚
â”‚ è¯´æ˜: ä» stats.price (6223380) è½¬æ¢ä¸º $0.0000062234                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ API è°ƒç”¨                                                          â”‚
â”‚ URL: http://localhost:8081/api/stats/{token}                        â”‚
â”‚ æ–¹æ³•: GET                                                            â”‚
â”‚ è¿”å›: {"price":"6223380","priceChange24h":"0",...}                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ åç«¯å¤„ç†                                                          â”‚
â”‚ æ–‡ä»¶: matching/server.ts:491-505 (handleGetStats)                   â”‚
â”‚ è°ƒç”¨: engine.getStats(token)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ å¼•æ“è®¡ç®—                                                          â”‚
â”‚ æ–‡ä»¶: matching/engine.ts:834-878 (getStats)                         â”‚
â”‚ è°ƒç”¨: orderBook.getCurrentPrice()                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¾ æ•°æ®æºå¤´                                                          â”‚
â”‚ æ¥æº1: è®¢å•ç°¿æˆäº¤ä»· (å¦‚æœæœ‰æˆäº¤)                                     â”‚
â”‚ æ¥æº2: TokenFactory.getCurrentPrice() (ç°è´§ä»·æ ¼åˆå§‹åŒ–)              â”‚
â”‚ åˆçº¦: 0xCfDCD9F8D39411cF855121331B09aef1C88dc056                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âœ… æ­£å¸¸
å½“å‰å€¼: price=6223380 â†’ $0.0000062234
```

---

### æ•°æ®çº¿ #2: è®¢å•ç°¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ˜¾ç¤º                                                          â”‚
â”‚ æ–‡ä»¶: PerpetualTradingTerminal.tsx:520-528                          â”‚
â”‚ ç»„ä»¶: <OrderBook data={wsOrderBook} />                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Hook è°ƒç”¨                                                         â”‚
â”‚ æ–‡ä»¶: hooks/useMatchingEngineWS.ts                                  â”‚
â”‚ ä»£ç : wsOrderBook æ¥è‡ª WebSocket è®¢é˜…                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”Œ WebSocket è¿æ¥                                                    â”‚
â”‚ URL: ws://localhost:8081                                            â”‚
â”‚ è®¢é˜…: { type: "subscribe", channel: "orderbook", token: "0x..." }   â”‚
â”‚ æ¶ˆæ¯: { type: "orderbook", data: { longs: [], shorts: [], ... } }   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ åç«¯æ¨é€                                                          â”‚
â”‚ æ–‡ä»¶: matching/server.ts:646-680 (broadcastOrderBook)               â”‚
â”‚ è°ƒç”¨: orderBook.getDepth(20)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¾ æ•°æ®æºå¤´                                                          â”‚
â”‚ æ¥æº: å†…å­˜ä¸­çš„è®¢å•ç°¿ (OrderBook ç±»)                                  â”‚
â”‚ æ–‡ä»¶: matching/engine.ts:77-225                                     â”‚
â”‚ è¯´æ˜: longOrders Map + shortOrders Map                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âœ… æ­£å¸¸ (è®¢å•ç°¿ä¸ºç©ºæ˜¯å› ä¸ºæ²¡äººä¸‹å•)
å½“å‰å€¼: longs=[], shorts=[], lastPrice=6223380
```

---

### æ•°æ®çº¿ #3: Kçº¿å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ˜¾ç¤º                                                          â”‚
â”‚ æ–‡ä»¶: PerpetualTradingTerminal.tsx:534                              â”‚
â”‚ ç»„ä»¶: <PerpetualPriceChart token={symbol} />                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ ç»„ä»¶å†…éƒ¨                                                          â”‚
â”‚ æ–‡ä»¶: components/trading/PerpetualPriceChart.tsx                    â”‚
â”‚ è°ƒç”¨: fetch(`${API_URL}/api/kline/${token}?interval=${interval}`)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ API è°ƒç”¨                                                          â”‚
â”‚ URL: http://localhost:8081/api/kline/{token}?interval=1h            â”‚
â”‚ æ–¹æ³•: GET                                                            â”‚
â”‚ è¿”å›: {"klines":[]}                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ åç«¯å¤„ç†                                                          â”‚
â”‚ æ–‡ä»¶: matching/server.ts:468-486 (handleGetKlines)                  â”‚
â”‚ è°ƒç”¨: engine.getKlines(token, interval, limit)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¾ æ•°æ®æºå¤´                                                          â”‚
â”‚ æ¥æº: æˆäº¤è®°å½•ç”Ÿæˆçš„ K çº¿                                            â”‚
â”‚ æ–‡ä»¶: matching/engine.ts (klineData Map)                            â”‚
â”‚ è¯´æ˜: æ²¡æœ‰æˆäº¤å°±æ²¡æœ‰ K çº¿                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âš ï¸ ç©ºæ•°æ® (æ²¡æœ‰æˆäº¤ï¼Œæ— æ³•ç”Ÿæˆ K çº¿)
å»ºè®®: å¯ç”¨ç°è´§ä»·æ ¼ç”Ÿæˆè™šæ‹Ÿ K çº¿ï¼Œæˆ–ç­‰å¾…çœŸå®æˆäº¤
```

---

### æ•°æ®çº¿ #4: èµ„é‡‘è´¹ç‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ˜¾ç¤º                                                          â”‚
â”‚ æ–‡ä»¶: PerpetualTradingTerminal.tsx:482-484                          â”‚
â”‚ ä»£ç : {marketInfo.fundingRate} / {marketInfo.nextFunding}           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Hook è°ƒç”¨                                                         â”‚
â”‚ æ–‡ä»¶: hooks/useFundingRate.ts                                       â”‚
â”‚ è°ƒç”¨: fetch(`${API_URL}/api/funding/${token}`)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ API è°ƒç”¨                                                          â”‚
â”‚ URL: http://localhost:8081/api/funding/{token}                      â”‚
â”‚ è¿”å›: {"rate":"1","nextFundingTime":...,"interval":"8h"}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ åç«¯å¤„ç†                                                          â”‚
â”‚ æ–‡ä»¶: matching/server.ts:509-517 (handleGetFundingRate)             â”‚
â”‚ è°ƒç”¨: engine.getFundingRate(token)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ å¼•æ“è®¡ç®—                                                          â”‚
â”‚ æ–‡ä»¶: matching/engine.ts:934-962 (calculateFundingRate)             â”‚
â”‚ å…¬å¼: åŸºç¡€è´¹ç‡ + (åˆçº¦ä»·-ç°è´§ä»·)/ç°è´§ä»· / 8                         â”‚
â”‚ è¯´æ˜: åˆçº¦ä»·=ç°è´§ä»·æ—¶ï¼Œè´¹ç‡=åŸºç¡€è´¹ç‡(0.01%)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âœ… æ­£å¸¸
å½“å‰å€¼: rate=1 (0.01% = 1 åŸºç‚¹)
```

---

### æ•°æ®çº¿ #5: å¼€ä»“äº¤æ˜“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ“ä½œ                                                          â”‚
â”‚ æ–‡ä»¶: components/trading/PerpetualOrderPanelV2.tsx                  â”‚
â”‚ æ“ä½œ: ç”¨æˆ·ç‚¹å‡» "Long" æˆ– "Short" æŒ‰é’®                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Hook è°ƒç”¨                                                         â”‚
â”‚ æ–‡ä»¶: hooks/usePerpetualV2.ts                                       â”‚
â”‚ å‡½æ•°: submitOrder()                                                 â”‚
â”‚ æ­¥éª¤1: ç”¨æˆ·ç­¾å EIP-712 è®¢å•                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ API è°ƒç”¨                                                          â”‚
â”‚ URL: http://localhost:8081/api/order/submit                         â”‚
â”‚ æ–¹æ³•: POST                                                           â”‚
â”‚ Body: { trader, token, isLong, size, leverage, price, signature }   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ åç«¯å¤„ç†                                                          â”‚
â”‚ æ–‡ä»¶: matching/server.ts:212-324 (handleOrderSubmit)                â”‚
â”‚ æ­¥éª¤1: éªŒè¯ç­¾å                                                      â”‚
â”‚ æ­¥éª¤2: engine.submitOrder() åŠ å…¥è®¢å•ç°¿                              â”‚
â”‚ æ­¥éª¤3: å°è¯•æ’®åˆ tryMatch()                                          â”‚
â”‚ æ­¥éª¤4: å¦‚æœæ’®åˆæˆåŠŸï¼Œåˆ›å»º Position                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— é“¾ä¸Šç»“ç®— (æ‰¹é‡)                                                   â”‚
â”‚ æ–‡ä»¶: matching/engine.ts (SettlementSubmitter)                      â”‚
â”‚ é—´éš”: æ¯ 30 ç§’æäº¤ä¸€æ¬¡                                               â”‚
â”‚ åˆçº¦: Settlement 0x48c551f36E74B8d21D26e21139623c6dd438e455         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âš ï¸ éœ€è¦æµ‹è¯•
æ½œåœ¨é—®é¢˜:
- ç”¨æˆ·éœ€è¦å…ˆè¿æ¥é’±åŒ…
- ç”¨æˆ·éœ€è¦å…ˆç”Ÿæˆäº¤æ˜“é’±åŒ… (æ´¾ç”Ÿé’±åŒ…)
- ç”¨æˆ·éœ€è¦æœ‰ä¿è¯é‡‘ (WETH ä½™é¢)
```

---

### æ•°æ®çº¿ #6: æˆ‘çš„æŒä»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ˜¾ç¤º                                                          â”‚
â”‚ æ–‡ä»¶: PerpetualTradingTerminal.tsx:570-654                          â”‚
â”‚ ä½ç½®: åº•éƒ¨ "Positions" æ ‡ç­¾é¡µ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¥æº1: V2 Matching Engine   â”‚    â”‚ æ¥æº2: é“¾ä¸Šåˆçº¦              â”‚
â”‚ Hook: usePerpetualV2        â”‚    â”‚ Hook: useReadContract       â”‚
â”‚ API: /api/user/{addr}/      â”‚    â”‚ åˆçº¦: PositionManager       â”‚
â”‚      positions              â”‚    â”‚ å‡½æ•°: getPositionByToken    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âš ï¸ æ•°æ®æ¥æºæ··ä¹±
é—®é¢˜:
- V2 æŒä»“æ¥è‡ªæ’®åˆå¼•æ“ (å†…å­˜)
- é“¾ä¸ŠæŒä»“æ¥è‡ªåˆçº¦ (éœ€è¦ç»“ç®—åæ‰æœ‰)
- ä¸¤ä¸ªæ¥æºå¯èƒ½ä¸ä¸€è‡´
```

---

### æ•°æ®çº¿ #7: æ´¾ç”Ÿäº¤æ˜“é’±åŒ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ“ä½œ                                                          â”‚
â”‚ æ–‡ä»¶: components/trading/PerpetualOrderPanelV2.tsx                  â”‚
â”‚ ä½ç½®: "Generate Trading Wallet" æŒ‰é’®                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Hook è°ƒç”¨                                                         â”‚
â”‚ æ–‡ä»¶: hooks/useTradingWallet.ts                                     â”‚
â”‚ å‡½æ•°: generateWallet()                                              â”‚
â”‚ æ­¥éª¤1: ç”¨æˆ·ç”¨ä¸»é’±åŒ…ç­¾åå›ºå®šæ¶ˆæ¯                                      â”‚
â”‚ æ­¥éª¤2: keccak256(signature) â†’ æ´¾ç”Ÿç§é’¥                              â”‚
â”‚ æ­¥éª¤3: ä¿å­˜åˆ° localStorage                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âœ… æ­£å¸¸
è¯´æ˜: æ´¾ç”Ÿé’±åŒ…ç”¨äºç­¾åè®¢å•ï¼Œä¸éœ€è¦ä¸»é’±åŒ…æ¯æ¬¡ç­¾å
```

---

### æ•°æ®çº¿ #8: å……å€¼ä¿è¯é‡‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ å‰ç«¯æ“ä½œ                                                          â”‚
â”‚ æ–‡ä»¶: hooks/useTradingWallet.ts                                     â”‚
â”‚ å‡½æ•°: wrapAndDeposit(amount)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ æ­¥éª¤1: è·å– Nonce                                                 â”‚
â”‚ API: GET /api/v1/relay/nonce/{address}                              â”‚
â”‚ åç«¯: Go Backend :8080                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ æ­¥éª¤2: ç­¾å EIP-712                                               â”‚
â”‚ ç±»å‹: Deposit(user,token,amount,deadline,nonce)                     â”‚
â”‚ ç”¨æˆ·: ç”¨æ´¾ç”Ÿé’±åŒ…ç­¾å                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ æ­¥éª¤3: è°ƒç”¨ Relay API                                             â”‚
â”‚ API: POST /api/v1/relay/deposit-eth                                 â”‚
â”‚ åç«¯: Go Backend :8080                                              â”‚
â”‚ Body: { user, amount, deadline, signature }                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— æ­¥éª¤4: é“¾ä¸Šæ‰§è¡Œ                                                   â”‚
â”‚ Relayer é’±åŒ…ä»£ä»˜ Gas                                                 â”‚
â”‚ åˆçº¦: Settlement.depositETHFor()                                    â”‚
â”‚ æ“ä½œ: ETH â†’ WETH â†’ å­˜å…¥ç”¨æˆ·ä½™é¢                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€: âš ï¸ éœ€è¦æµ‹è¯•
ä¾èµ–:
- Relayer é’±åŒ…éœ€è¦æœ‰ ETH (å½“å‰ ~1 ETH)
- Settlement åˆçº¦éœ€è¦è®¾ç½® WETH åœ°å€
- ç”¨æˆ·æ´¾ç”Ÿé’±åŒ…éœ€è¦æœ‰ ETH
```

---

## ä¸‰ã€å·²å‘ç°çš„é—®é¢˜æ¸…å•

| ç¼–å· | é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ |
|------|------|----------|------|
| P001 | Kçº¿ä¸ºç©º (æ²¡æœ‰æˆäº¤è®°å½•) | âš ï¸ ä¸­ | é¢„æœŸè¡Œä¸º |
| P002 | è®¢å•ç°¿ä¸ºç©º (æ²¡æœ‰æŒ‚å•) | âš ï¸ ä¸­ | é¢„æœŸè¡Œä¸º |
| P003 | æŒä»“æ•°æ®æ¥æºæ··ä¹± (æ’®åˆå¼•æ“ vs é“¾ä¸Š) | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| P004 | æ´¾ç”Ÿé’±åŒ…ä½™é¢ä¸º 0 (éœ€è¦å……å€¼) | âš ï¸ ä¸­ | ç”¨æˆ·æ“ä½œ |
| P005 | æ²¡æœ‰åšå¸‚å•†æŒ‚å• | âš ï¸ ä¸­ | éœ€è¦åšå¸‚å•† |
| P006 | æ’®åˆå¼•æ“ä½¿ç”¨æ—§çš„ Settlement åˆçº¦åœ°å€ | ğŸ”´ ä¸¥é‡ | âœ… å·²ä¿®å¤ |
| P007 | Matcher æœªæˆæƒåˆ° Settlement åˆçº¦ | ğŸ”´ ä¸¥é‡ | âœ… å·²ä¿®å¤ |
| P008 | è®¢å•ä¸æ˜¾ç¤ºåœ¨UIï¼ˆå‰ç«¯ä½¿ç”¨é”™è¯¯åœ°å€æŸ¥è¯¢ï¼‰ | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| P009 | è®¢å•è¯¦ç»†ä¿¡æ¯ä¸å®Œæ•´ï¼ˆç¼ºå°‘è¡Œä¸šæ ‡å‡†å­—æ®µï¼‰ | âš ï¸ ä¸­ | âœ… å·²ä¿®å¤ |

---

## ä¸‰-Aã€é—®é¢˜ä¿®å¤è®°å½• (2026-01-26)

### P006: Settlement åˆçº¦åœ°å€é…ç½®é”™è¯¯

**é—®é¢˜æè¿°:**
æ’®åˆå¼•æ“ `/backend/src/matching/.env` ä¸­é…ç½®çš„ SETTLEMENT_ADDRESS æ˜¯æ—§åœ°å€ `0xB06C32C7536EC5EAD101fEe2AD4005a5eedcB258`ï¼Œè€Œå®é™…éƒ¨ç½²çš„æ–°åˆçº¦åœ°å€æ˜¯ `0x48c551f36E74B8d21D26e21139623c6dd438e455`ã€‚

**è¡¨ç°:**
```
The contract function "settleBatch" reverted with the following signature: 0xf4d678b8
Contract Call: address: 0xB06C32C7536EC5EAD101fEe2AD4005a5eedcB258
```

**ä¿®å¤:**
æ›´æ–° `/backend/src/matching/.env`:
```
SETTLEMENT_ADDRESS=0x48c551f36E74B8d21D26e21139623c6dd438e455
```

### P007: Matcher æœªæˆæƒ

**é—®é¢˜æè¿°:**
æ’®åˆå¼•æ“çš„ Matcher åœ°å€ (`0x5AF11d4784c3739cf2FD51Fdc272ae4957ADf7fE`) æœªè¢«æˆæƒåˆ° Settlement åˆçº¦ã€‚

**ä¿®å¤:**
ä½¿ç”¨ Settlement åˆçº¦ owner (`0xF339fCf70939e04C8Ce79391BB47bB943122949C`) æ‰§è¡Œæˆæƒ:
```bash
cast send 0x48c551f36E74B8d21D26e21139623c6dd438e455 "setAuthorizedMatcher(address,bool)" 0x5AF11d4784c3739cf2FD51Fdc272ae4957ADf7fE true --private-key <owner_private_key>
```

**éªŒè¯:**
```bash
cast call 0x48c551f36E74B8d21D26e21139623c6dd438e455 "authorizedMatchers(address)(bool)" 0x5AF11d4784c3739cf2FD51Fdc272ae4957ADf7fE
# è¿”å›: true
```

### P003: æŒä»“æ•°æ®æ¥æºæ··ä¹±

**é—®é¢˜æè¿°:**
å‰ç«¯åŒæ—¶ä»ä¸¤ä¸ªæ¥æºè·å–ä»“ä½æ•°æ®ï¼š
1. æ’®åˆå¼•æ“ API (`/api/user/{trader}/positions`) - V2 ç³»ç»Ÿçš„ä¸»æ•°æ®æº
2. æ—§çš„ PositionManager åˆçº¦ - V1 ç³»ç»Ÿçš„é—ç•™ä»£ç 

æ’®åˆå¼•æ“é‡å¯åå†…å­˜ä¸­çš„ä»“ä½æ•°æ®ä¸¢å¤±ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚

**ä¿®å¤:**

1. **åç«¯ï¼ˆæ’®åˆå¼•æ“ï¼‰**ï¼šå¯åŠ¨æ—¶ä»é“¾ä¸Š Settlement åˆçº¦åŒæ­¥å·²æœ‰ä»“ä½
   - æ–°å¢ `syncPositionsFromChain()` å‡½æ•°
   - å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹åæ¯ 5 åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
   - æ–‡ä»¶ï¼š`/backend/src/matching/server.ts`

2. **å‰ç«¯**ï¼šç§»é™¤å¯¹æ—§ PositionManager åˆçº¦çš„ä¾èµ–
   - åˆ é™¤ `useReadContract` å¯¹ PositionManager çš„è°ƒç”¨
   - ç»Ÿä¸€ä½¿ç”¨ `usePerpetualV2` hook çš„æ•°æ®
   - æ–‡ä»¶ï¼š`/frontend/src/components/trading/PerpetualTradingTerminal.tsx`

**éªŒè¯:**
```
[Sync] Total pairs on chain: 1
[Sync] Synced 2 positions from 1 active pairs
[Server] Initial position sync completed
```

### P008: è®¢å•ä¸æ˜¾ç¤ºåœ¨UIï¼ˆå‰ç«¯ä½¿ç”¨é”™è¯¯åœ°å€æŸ¥è¯¢ï¼‰

**é—®é¢˜æè¿°:**
ç”¨æˆ·ä½¿ç”¨æ´¾ç”Ÿäº¤æ˜“é’±åŒ… (å¦‚ `0xE4df9f4BBefA59D9B233961FecEaCdEdf1AE2E5d`) æäº¤è®¢å•ï¼Œè®¢å•å­˜åœ¨äºæ’®åˆå¼•æ“ä¸­ï¼Œä½†å‰ç«¯çš„"å½“å‰å§”æ‰˜"å’Œè®¢å•ç°¿ä¸­ä¸æ˜¾ç¤ºã€‚

**æ ¹æœ¬åŸå› :**
`PerpetualTradingTerminal.tsx` è°ƒç”¨ `usePerpetualV2()` æ—¶æ²¡æœ‰ä¼ é€’ `tradingWalletAddress` å‚æ•°ï¼Œå¯¼è‡´ hook ä½¿ç”¨ MetaMask ä¸»é’±åŒ…åœ°å€ï¼ˆå¦‚ `0xF339fCf70939e04C8Ce79391BB47bB943122949C`ï¼‰è€Œä¸æ˜¯æ´¾ç”Ÿäº¤æ˜“é’±åŒ…åœ°å€æ¥æŸ¥è¯¢è®¢å•ã€‚

**ä¿®å¤:**
1. åœ¨ `PerpetualTradingTerminal.tsx` ä¸­è°ƒç”¨ `useTradingWallet()` hook è·å–äº¤æ˜“é’±åŒ…ä¿¡æ¯
2. å°† `tradingWalletAddress` å’Œ `tradingWalletSignature` ä¼ é€’ç»™ `usePerpetualV2()`
3. æ›´æ–°è½®è¯¢ useEffect çš„ä¾èµ–é¡¹

**ä¿®æ”¹æ–‡ä»¶:** `/frontend/src/components/trading/PerpetualTradingTerminal.tsx`

```typescript
// è·å–äº¤æ˜“é’±åŒ…ä¿¡æ¯
const {
  address: tradingWalletAddress,
  getSignature,
  isInitialized: isTradingWalletInitialized,
} = useTradingWallet();

// è·å–äº¤æ˜“é’±åŒ…ç­¾å
const tradingWalletSignature = getSignature();

// ä¼ é€’ç»™ usePerpetualV2
const { ... } = usePerpetualV2({
  tradingWalletAddress: tradingWalletAddress || undefined,
  tradingWalletSignature: tradingWalletSignature || undefined,
});
```

### P009: è®¢å•è¯¦ç»†ä¿¡æ¯ä¸å®Œæ•´ï¼ˆç¼ºå°‘è¡Œä¸šæ ‡å‡†å­—æ®µï¼‰

**é—®é¢˜æè¿°:**
è®¢å•ä¿¡æ¯åªåŒ…å«åŸºæœ¬å­—æ®µï¼ˆid, token, isLong, size, price, status, filledSize, createdAtï¼‰ï¼Œç¼ºå°‘è¡Œä¸šæ ‡å‡†äº¤æ˜“æ‰€ï¼ˆOKX/Binanceï¼‰çš„å®Œæ•´å­—æ®µã€‚

**å¯¹æ¯”è¡Œä¸šæ ‡å‡†:**

| å­—æ®µ | ä¿®å¤å‰ | OKX | Binance |
|------|--------|-----|---------|
| å¹³å‡æˆäº¤ä»· (avgFillPrice) | âŒ | âœ… avgPx | âœ… avgPrice |
| æ æ†å€æ•° (leverage) | âŒ | âœ… lever | - |
| è®¢å•ç±»å‹ (orderType) | âŒ | âœ… ordType | âœ… type |
| æœ‰æ•ˆæœŸ (timeInForce) | âŒ | âœ… | âœ… GTC/IOC/FOK |
| ä¿è¯é‡‘ (margin) | âŒ | âœ… | - |
| æ‰‹ç»­è´¹ (fee) | âŒ | âœ… | - |
| åªå‡ä»“ (reduceOnly) | âŒ | âœ… | âœ… |
| æ›´æ–°æ—¶é—´ (updatedAt) | âŒ | âœ… uTime | âœ… updateTime |
| æ­¢ç›ˆæ­¢æŸä»· | âŒ | âœ… | âœ… stopPrice |
| ç´¯è®¡æˆäº¤é¢ | âŒ | âœ… fillNotionalUsd | âœ… cumQuote |
| è®¢å•æ¥æº (source) | âŒ | âœ… | - |

**ä¿®å¤:**

1. **åç«¯ Order æ¥å£æ‰©å±•** (`/backend/src/matching/engine.ts`):
   - æ·»åŠ  TimeInForce æšä¸¾ (GTC/IOC/FOK/GTD)
   - æ·»åŠ  OrderSource æšä¸¾ (API/WEB/APP)
   - Order æ¥å£æ·»åŠ  40+ ä¸ªè¡Œä¸šæ ‡å‡†å­—æ®µ
   - æ–°å¢ `updateOrderFillInfo()` å‡½æ•°è®¡ç®—æˆäº¤ä¿¡æ¯

2. **åç«¯ API è¿”å›å®Œæ•´ä¿¡æ¯** (`/backend/src/matching/server.ts`):
   - `handleGetUserOrders()` è¿”å›æ‰€æœ‰è¡Œä¸šæ ‡å‡†å­—æ®µ

3. **å‰ç«¯ OrderInfo æ¥å£** (`/frontend/src/hooks/usePerpetualV2.ts`):
   - æ›´æ–°ä¸ºå®Œæ•´çš„è¡Œä¸šæ ‡å‡†ç±»å‹å®šä¹‰

4. **å‰ç«¯è®¢å•åˆ—è¡¨ UI** (`/frontend/src/components/trading/PerpetualTradingTerminal.tsx`):
   - æ˜¾ç¤º 13 åˆ—å®Œæ•´è®¢å•ä¿¡æ¯
   - åŒ…å«ï¼šæ—¶é—´ã€äº¤æ˜“å¯¹ã€ç±»å‹ã€æ–¹å‘ã€æ æ†ã€å§”æ‰˜ä»·ã€å§”æ‰˜é‡ã€æˆäº¤å‡ä»·ã€å·²æˆäº¤/æ€»é‡ã€ä¿è¯é‡‘ã€æ‰‹ç»­è´¹ã€çŠ¶æ€ã€æ“ä½œ

**æ–°å¢å­—æ®µåˆ—è¡¨:**
- `clientOrderId` - ç”¨æˆ·è‡ªå®šä¹‰è®¢å•ID
- `leverage` - æ æ†å€æ•°
- `orderType` - è®¢å•ç±»å‹ (MARKET/LIMIT)
- `timeInForce` - æœ‰æ•ˆæœŸç±»å‹ (GTC/IOC/FOK/GTD)
- `reduceOnly` - æ˜¯å¦åªå‡ä»“
- `avgFillPrice` - å¹³å‡æˆäº¤ä»·æ ¼
- `totalFillValue` - ç´¯è®¡æˆäº¤é‡‘é¢
- `fee` / `feeCurrency` - æ‰‹ç»­è´¹åŠå¸ç§
- `margin` / `collateral` - ä¿è¯é‡‘ä¿¡æ¯
- `takeProfitPrice` / `stopLossPrice` - æ­¢ç›ˆæ­¢æŸ
- `updatedAt` / `lastFillTime` - æ—¶é—´æˆ³
- `source` - è®¢å•æ¥æº
- `lastFillPrice` / `lastFillSize` / `tradeId` - æœ€åæˆäº¤æ˜ç»†

---

## å››ã€åˆçº¦çŠ¶æ€æ£€æŸ¥

| åˆçº¦ | åœ°å€ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| Settlement | 0x48c551f36E74B8d21D26e21139623c6dd438e455 | P2Pç»“ç®— | âœ… WETH é…ç½®æ­£ç¡®, Matcher å·²æˆæƒ |
| TokenFactory | 0xCfDCD9F8D39411cF855121331B09aef1C88dc056 | Memeå¸å‘è¡Œ | âœ… æ­£å¸¸ |
| PriceFeed | 0xd69A4DB60cEc962A46C6B9Bc8CC0883081c4eFb7 | ä»·æ ¼é¢„è¨€æœº | å¾…æ£€æŸ¥ |

### Settlement åˆçº¦è¯¦ç»†æ£€æŸ¥

```
Owner: 0xF339fCf70939e04C8Ce79391BB47bB943122949C
WETH: 0x4200000000000000000000000000000000000006 âœ…
Authorized Matcher: 0x5AF11d4784c3739cf2FD51Fdc272ae4957ADf7fE âœ…
```

---

## äº”ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. [x] æ£€æŸ¥ Settlement åˆçº¦çŠ¶æ€ - âœ… å·²å®Œæˆ
2. [x] ä¿®å¤ Matcher æˆæƒé—®é¢˜ (P006, P007) - âœ… å·²å®Œæˆ
3. [x] ä¿®å¤æŒä»“æ•°æ®æ¥æºé—®é¢˜ (P003) - âœ… å·²å®Œæˆ
4. [x] ä¿®å¤è®¢å•ä¸æ˜¾ç¤ºåœ¨UIçš„é—®é¢˜ (P008) - âœ… å·²å®Œæˆ
5. [x] å®Œå–„è®¢å•è¯¦ç»†ä¿¡æ¯ä¸ºè¡Œä¸šæ ‡å‡† (P009) - âœ… å·²å®Œæˆ
6. [ ] é‡å¯æ’®åˆå¼•æ“ä½¿æ”¹åŠ¨ç”Ÿæ•ˆ
7. [ ] æµ‹è¯•å®Œæ•´çš„å¼€ä»“æµç¨‹ï¼ˆéœ€è¦åˆ·æ–°å‰ç«¯é¡µé¢éªŒè¯ï¼‰
8. [ ] æµ‹è¯•å……å€¼æµç¨‹
9. [ ] éƒ¨ç½²åšå¸‚å•†æœºå™¨äºº
